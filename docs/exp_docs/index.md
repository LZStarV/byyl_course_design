# 实验一：功能模块设计及实现（算法与核心实现）

## 前言

在每一小节开头，我们会告知读者本功能模块所需要使用到的重要数据结构（与存储结构）的名称、用途及其各个字段的名称、类型以及说明；对于较为复杂的数据结构，笔者将在文中绘制对应的示意图，以便读者方便理解。其中，部分单字段数据结构并没有使用结构体存储，以方便进行访问。

随后，我们将详细阐述功能模块的实现原理、实现细节以及重要的核心代码或片段。对于较为重点的功能，笔者在讲解这一功能实现后，会添加上必要的单元测试，以保证实现的正确性与鲁棒性。

本前言适用于【实验一】与【实验二】两部分：
- 实验一侧重词法：正则与命名解析、AST 构建、Thompson 构造 NFA、子集构造 DFA、Hopcroft 最小化、状态表生成、词法代码生成、组合扫描与编码输出。
- 实验二侧重语法：BNF 文法解析、First/Follow 计算、LR(0)/LR(1) 项集 DFA 构造与分析表生成、SLR(1) 判断、LR(1) 语法分析流程可视化与语法树生成、语法代码导出与验证。

## 图片插入位置与简单描述

为便于后续统一绘制与插入图片，现汇总各模块文档中的图片占位位置与简要说明（占位均已分散插入在对应文档的关联段落处）：

【实验一】
- 01_正则解析与预处理.md：
  - 位置：在“构造 RegexFile：宏进入 rules，Token 进入 tokens”段落之后。
  - 描述：加载正则文件界面图；展示打开 .regex 文件与解析统计信息。
  - 位置：在“算法实现过程”段落之后。
  - 描述：规则文本解析流程图；展示文本→行处理→命名头→宏/Token 集合。
  - 位置：在“算法实现过程”段落关于“预处理”说明之后。
  - 描述：预处理流程图；展示从原始正则文本到字母表的关键步骤与关系。
  - 位置（新增）：在“单元测试”段落之后。
  - 描述：CliRegexTest 运行截图（命令行正则解析与统计）。
- 02_AST 构建（RegexParser）.md：
  - 位置：在“连接与选择”段落之后。
  - 描述：AST 示例图；展示包含连接/选择/后缀运算的一棵典型表达式树。
- 03_Thompson 方法转 NFA.md：
  - 位置：分别在各运算符说明段落中（单字符/ε、连接、选择、闭包、正闭包、可选、字符类）。
  - 描述：对应的 NFA 构造示意图；展示头/尾节点、ε 边与片段拼接方式。
  - 位置（新增）：在“算法实现过程（编号式）”段落之后。
  - 描述：Thompson 构造流程图；展示递归分派与片段组合流程。
  - 位置（新增）：在“单元测试”段落之后。
  - 描述：FACoreTest 运行截图（NFA 结构检查）。
- 04_子集构造算法（NFA→DFA）.md：
  - 位置：在“步骤拆分”之后。
  - 描述：子集构造流程图；展示 ε-闭包、move、集合去重与编号的循环过程。
  - 位置（新增）：在“单元测试”段落之后。
  - 描述：FACoreTest DFA 运行截图（无 ε 转移检查）。
- 05_Hopcroft 最小化算法（DFA→MinDFA）.md：
  - 位置：在“步骤拆分”之后。
  - 描述：Hopcroft 划分示意图；展示初始划分与若干轮细分后的分区对比。
  - 位置（新增）：在“算法实现过程（编号式）”段落之后。
  - 描述：Hopcroft 迭代流程图；展示初始划分→细分→队列推进→收敛→重建。
  - 位置（新增）：在“单元测试”段落之后。
  - 描述：FACoreTest MinDFA 运行截图（起始态断言）。
- 06_状态表生成（Engine）.md：
  - 位置：在“步骤拆分”中关于三类状态表的说明之后。
  - 描述：NFA/DFA/MinDFA 状态表截图；展示表头（标记/状态/符号列）与示例行。
  - 位置（新增）：在“算法实现过程（编号式）”段落之后。
  - 描述：状态表生成流程图；展示列构造→行填充→标记设置→宏聚合。
- 07_词法代码生成（CodeGenerator）.md：
  - 位置：在“AcceptState/Step”说明段落之后。
  - 描述：代码查看页签截图；展示生成的 Step/AcceptState 片段与分发表。
  - 位置（新增）：在“算法实现过程（编号式）”段落之后。
  - 描述：代码生成管线流程图；展示状态遍历→函数生成→分发表→权重与跳过→主程序。
  - 位置（新增）：在“单元测试”段落之后。
  - 描述：CodegenTest 运行截图（编译退出码与运行输出）。
- 09_组合扫描与编码输出（Engine.runMultiple）.md：
  - 位置：在“词素追加与输出”说明段落之后。
  - 描述：测试与验证页签截图；展示输入示例源与输出编码序列（包含追加词素）。
  - 位置（新增）：在“算法实现过程（编号式）”段落之后。
  - 描述：组合扫描流程图；展示跳过策略→遍历 DFA→最长匹配→权重选择→输出与推进。
  - 位置（新增）：在“单元测试”段落之后。
  - 描述：LongestMatchTest / CliRegexTest 运行截图（断言与输出统计）。

【实验二】（图片占位将按同样原则就近插入于对应文档）
- 文法编辑与解析：
  - 位置：在“BNF 文法解析”说明后。
  - 描述：文法编辑界面图；展示文法文本加载与解析状态。
- First/Follow 计算：
  - 位置：在“First/Follow 表格展示”说明后。
  - 描述：First 表与 Follow 表截图；展示非终结符的集合结果与表头。
- LR(0) 项集与 DFA：
  - 位置：在“LR(0) 项集构造”说明后。
  - 描述：LR(0) 项集图或表格截图；展示点集、转移与闭包关系。
- SLR(1) 判断：
  - 位置：在“SLR(1) 判断与冲突明细”说明后。
  - 描述：判断结果截图；展示是否为 SLR(1) 及冲突原因（如移进/归约冲突）。
- LR(1) 项集与分析表：
  - 位置：在“LR(1) DFA 与 Action/GOTO 表生成”说明后。
  - 描述：LR(1) 项集图与 LR(1) 分析表截图；展示项目集合与动作/转移表头。
- LR(1) 语法分析过程：
  - 位置：在“逐步语法分析过程可视化”说明后。
  - 描述：分析过程表格截图；逐步展示栈、输入、动作与说明文字。
- 语法树生成与预览：
  - 位置：在“语义树 DOT 与文本树视图”说明后。
  - 描述：语法树 DOT 示意图与文本树视图截图；展示树形结构与关键节点。
- 语法代码生成：
  - 位置：在“语法代码导出”说明后。
  - 描述：语法代码查看页签截图；展示生成代码的核心函数片段。

## 写作规范与示例风格

- 每一模块采用【数据结构（表格）】+【步骤拆分】+【详细过程讲解】+【各种情况讲解】+【关键代码片段】的结构撰写。
- 代码片段直接粘贴实现的核心片段进行讲解，不包含任何文件路径或行号标注。
- 图片以占位注释标注，并与相邻文字形成紧密关联（示例：在说明段落中加入“下图展示 XXX”，随后跟随占位注释）：
  - `<!--【图片类型】此处需要添加 'XXX 图'：简述... -->`

<!-- 提示：各模块已在相应位置分散插入图片占位注释，请结合文字说明添加对应截图或示意图。 -->
